<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Church Admin Panel</title>
  <link rel="stylesheet" href="/admin/styles.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>Church Management Admin Panel</h1>
      <button id="logoutBtn" class="btn-secondary">Logout</button>
    </header>

    <div class="tabs">
      <button class="tab-btn active" data-tab="config">Configuration</button>
      <button class="tab-btn" data-tab="announcements">Announcements</button>
      <button class="tab-btn" data-tab="members">Members Upload</button>
      <button class="tab-btn" data-tab="households">Households Upload</button>
      <button class="tab-btn" data-tab="donations">Donations Upload</button>
      <button class="tab-btn" data-tab="admins">Admin Management</button>
    </div>

    <!-- Configuration Tab -->
    <div id="config-tab" class="tab-content active">
      <h2>Church Configuration</h2>
      <form id="configForm">
        <div class="form-group">
          <label for="churchName">Church Name</label>
          <input type="text" id="churchName" name="churchName" required>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="primaryColor">Primary Color</label>
            <input type="color" id="primaryColor" name="primaryColor" required>
          </div>

          <div class="form-group">
            <label for="secondaryColor">Secondary Color</label>
            <input type="color" id="secondaryColor" name="secondaryColor" required>
          </div>

          <div class="form-group">
            <label for="accentColor">Accent Color</label>
            <input type="color" id="accentColor" name="accentColor" required>
          </div>
        </div>

        <div class="form-group">
          <label for="logoUrl">Logo URL</label>
          <input type="url" id="logoUrl" name="logoUrl" placeholder="https://example.com/logo.png">
        </div>

        <div class="form-group">
          <label for="calendarId">Calendar ID (Google Calendar)</label>
          <input type="text" id="calendarId" name="calendarId" placeholder="admin@yourchurch.org">
        </div>

        <div class="form-group">
          <label for="timezone">Timezone</label>
          <select id="timezone" name="timezone" required style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 14px;">
            <option value="America/New_York">Eastern Time (America/New_York)</option>
            <option value="America/Chicago">Central Time (America/Chicago)</option>
            <option value="America/Denver">Mountain Time (America/Denver)</option>
            <option value="America/Phoenix">Arizona Time (America/Phoenix)</option>
            <option value="America/Los_Angeles">Pacific Time (America/Los_Angeles)</option>
            <option value="America/Anchorage">Alaska Time (America/Anchorage)</option>
            <option value="Pacific/Honolulu">Hawaii Time (Pacific/Honolulu)</option>
            <option value="Europe/London">London (Europe/London)</option>
            <option value="Europe/Paris">Paris (Europe/Paris)</option>
            <option value="Asia/Dubai">Dubai (Asia/Dubai)</option>
            <option value="Asia/Kolkata">India (Asia/Kolkata)</option>
            <option value="Asia/Singapore">Singapore (Asia/Singapore)</option>
            <option value="Asia/Tokyo">Tokyo (Asia/Tokyo)</option>
            <option value="Australia/Sydney">Sydney (Australia/Sydney)</option>
          </select>
        </div>

        <h3>API Endpoints</h3>
        
        <div class="form-group">
          <label for="iconcmo">IconCMO API URL</label>
          <input type="url" id="iconcmo" name="iconcmo" placeholder="https://api.iconcmo.com">
        </div>


        <div class="form-group">
          <label for="standardPayments">Standard Payments URL</label>
          <input type="url" id="standardPayments" name="standardPayments" placeholder="https://yourchurch.org/donate">
        </div>

        <div class="button-group">
          <button type="submit" class="btn-primary">Save Configuration</button>
          <button type="button" id="loadConfigBtn" class="btn-secondary">Load Current Config</button>
        </div>
      </form>

      <div id="configPreview" class="preview-section">
        <h3>Preview</h3>
        <div class="preview-box">
          <div id="previewHeader" class="preview-header">
            <div id="previewLogo" class="preview-logo">Church</div>
            <div id="previewChurchName" class="preview-church-name">Church Management</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Announcements Tab -->
    <div id="announcements-tab" class="tab-content">
      <h2>Manage Announcements</h2>
      <p style="color: #666; margin-bottom: 20px;">Manage two active announcements that will display in the mobile app based on their date ranges.</p>
      
      <form id="announcementsForm">
        <!-- Announcement 1 -->
        <div class="announcement-section">
          <h3>Announcement 1</h3>
          <input type="hidden" id="announcement1Id" name="announcement1Id">
          
          <div class="form-group">
            <label for="announcement1Content">Announcement Text</label>
            <textarea id="announcement1Content" name="announcement1Content" rows="4" 
                      placeholder="Enter your announcement text here..." required></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="announcement1StartDate">Start Date</label>
              <input type="datetime-local" id="announcement1StartDate" name="announcement1StartDate" required>
            </div>

            <div class="form-group">
              <label for="announcement1EndDate">End Date</label>
              <input type="datetime-local" id="announcement1EndDate" name="announcement1EndDate" required>
            </div>
          </div>
        </div>

        <!-- Announcement 2 -->
        <div class="announcement-section">
          <h3>Announcement 2</h3>
          <input type="hidden" id="announcement2Id" name="announcement2Id">
          
          <div class="form-group">
            <label for="announcement2Content">Announcement Text</label>
            <textarea id="announcement2Content" name="announcement2Content" rows="4" 
                      placeholder="Enter your announcement text here..." required></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="announcement2StartDate">Start Date</label>
              <input type="datetime-local" id="announcement2StartDate" name="announcement2StartDate" required>
            </div>

            <div class="form-group">
              <label for="announcement2EndDate">End Date</label>
              <input type="datetime-local" id="announcement2EndDate" name="announcement2EndDate" required>
            </div>
          </div>
        </div>

        <div class="button-group">
          <button type="submit" class="btn-primary">Save Announcements</button>
          <button type="button" id="loadAnnouncementsBtn" class="btn-secondary">Load Current Announcements</button>
        </div>
      </form>

      <div id="announcementsResult" class="result-box"></div>
    </div>

    <!-- Members Upload Tab -->
    <div id="members-tab" class="tab-content">
      <h2>Upload Members Data</h2>
      <div class="upload-section">
        <div class="info-box">
          <h3>Excel Format Requirements</h3>
          <p>Your Excel file should have the following columns:</p>
          <ul>
            <li><strong>household_id</strong> - Unique household identifier</li>
            <li><strong>member_id</strong> - Unique member identifier</li>
            <li><strong>firstname</strong> - First name</li>
            <li><strong>lastname</strong> - Last name</li>
            <li><strong>relationship</strong> - Relationship (e.g., Head, Spouse, Child)</li>
            <li><strong>birth_date</strong> - Date of birth (YYYY-MM-DD)</li>
            <li><strong>wed_date</strong> - Wedding date (YYYY-MM-DD, optional)</li>
            <li><strong>email</strong> - Email address (optional)</li>
            <li><strong>phone</strong> - Phone number (optional)</li>
          </ul>
        </div>

        <p style="margin-bottom: 15px; padding: 10px; background: #f0f0f0; border-radius: 5px;">
          ðŸ“¥ <a href="/templates/members_template.csv" download style="color: #C41E3A; text-decoration: none; font-weight: 500;">Download Members Template (CSV)</a>
        </p>

        <form id="membersUploadForm">
          <div class="form-group">
            <label for="membersFile">Select Excel File (.xlsx)</label>
            <input type="file" id="membersFile" name="file" accept=".xlsx,.xls,.csv" required>
          </div>
          <button type="submit" class="btn-primary" id="membersUploadBtn">Upload Members</button>
        </form>

        <div id="membersProgress" class="progress-container" style="display:none;">
          <div class="progress-bar">
            <div class="progress-fill" id="membersProgressFill"></div>
          </div>
          <div class="progress-text" id="membersProgressText">Uploading... 0%</div>
        </div>

        <div id="membersResult" class="result-box"></div>
      </div>
    </div>

    <!-- Households Upload Tab -->
    <div id="households-tab" class="tab-content">
      <h2>Upload Households Data</h2>
      <div class="upload-section">
        <div class="info-box">
          <h3>Excel Format Requirements</h3>
          <p>Your Excel file should have the following columns:</p>
          <ul>
            <li><strong>household_id</strong> - Unique household identifier</li>
            <li><strong>mail_to</strong> - Household name (e.g., "The Smith Family")</li>
            <li><strong>address</strong> - Street address (optional)</li>
            <li><strong>city</strong> - City (optional)</li>
            <li><strong>state</strong> - State (optional)</li>
            <li><strong>zip</strong> - ZIP code (optional)</li>
            <li><strong>phone</strong> - Phone number (optional)</li>
            <li><strong>email</strong> - Email address (optional)</li>
            <li><strong>prayer_group</strong> - Prayer group name (optional)</li>
            <li><strong>donor_number</strong> - Donor ID/number (optional)</li>
          </ul>
        </div>

        <p style="margin-bottom: 15px; padding: 10px; background: #f0f0f0; border-radius: 5px;">
          ðŸ“¥ <a href="/templates/households_template.csv" download style="color: #C41E3A; text-decoration: none; font-weight: 500;">Download Households Template (CSV)</a>
        </p>

        <form id="householdsUploadForm">
          <div class="form-group">
            <label for="householdsFile">Select Excel File (.xlsx)</label>
            <input type="file" id="householdsFile" name="file" accept=".xlsx,.xls,.csv" required>
          </div>
          <button type="submit" class="btn-primary" id="householdsUploadBtn">Upload Households</button>
        </form>

        <div id="householdsProgress" class="progress-container" style="display:none;">
          <div class="progress-bar">
            <div class="progress-fill" id="householdsProgressFill"></div>
          </div>
          <div class="progress-text" id="householdsProgressText">Uploading... 0%</div>
        </div>

        <div id="householdsResult" class="result-box"></div>
      </div>
    </div>

    <!-- Donations Upload Tab -->
    <div id="donations-tab" class="tab-content">
      <h2>Upload Donations Data</h2>
      <div class="upload-section">
        <div class="info-box">
          <h3>Excel Format Requirements</h3>
          <p>Your Excel file should have the following columns:</p>
          <ul>
            <li><strong>household_id</strong> - Household identifier</li>
            <li><strong>donor_number</strong> - Donor ID/number</li>
            <li><strong>fund</strong> - Fund name or category (e.g., "General Fund", "Building Fund")</li>
            <li><strong>amount</strong> - Donation amount (numeric)</li>
            <li><strong>donation_date</strong> - Date of donation (YYYY-MM-DD, optional)</li>
          </ul>
          <p style="margin-top: 10px; color: #666;">
            <strong>Note:</strong> The update date will be set automatically when you upload the file.
          </p>
        </div>

        <p style="margin-bottom: 15px; padding: 10px; background: #f0f0f0; border-radius: 5px;">
          ðŸ“¥ <a href="/templates/donations_template.csv" download style="color: #C41E3A; text-decoration: none; font-weight: 500;">Download Donations Template (CSV)</a>
        </p>

        <form id="donationsUploadForm">
          <div class="form-group">
            <label for="donationsFile">Select Excel File (.xlsx)</label>
            <input type="file" id="donationsFile" name="file" accept=".xlsx,.xls,.csv" required>
          </div>
          <button type="submit" class="btn-primary" id="donationsUploadBtn">Upload Donations</button>
        </form>

        <div id="donationsProgress" class="progress-container" style="display:none;">
          <div class="progress-bar">
            <div class="progress-fill" id="donationsProgressFill"></div>
          </div>
          <div class="progress-text" id="donationsProgressText">Uploading... 0%</div>
        </div>

        <div id="donationsResult" class="result-box"></div>
      </div>
    </div>

    <!-- Admin Management Tab -->
    <div id="admins-tab" class="tab-content">
      <h2>Admin Management</h2>
      <p style="color: #666; margin-bottom: 20px;">Manage administrator access for users. At least one admin must always remain.</p>
      
      <!-- Current Admins Section -->
      <div style="margin-bottom: 40px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
          <h3 style="margin: 0;">Current Administrators</h3>
          <button type="button" id="refreshAdminsBtn" class="btn-secondary" style="padding: 8px 16px;">Refresh List</button>
        </div>
        
        <div id="adminsList" style="background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
          <p style="color: #999; text-align: center;">Loading administrators...</p>
        </div>
      </div>

      <!-- Grant Admin Access Section -->
      <div style="margin-bottom: 40px;">
        <h3>Grant Admin Access</h3>
        <p style="color: #666; margin-bottom: 15px;">Select a user to grant administrator privileges.</p>
        
        <form id="grantAdminForm" style="background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
          <div class="form-group">
            <label for="userEmail">Enter Email Address</label>
            <input type="email" id="userEmail" required placeholder="user@example.com" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
          </div>
          
          <button type="submit" class="btn-primary">Grant Admin Access</button>
        </form>
        
        <div id="grantAdminResult" class="result-box"></div>
      </div>
    </div>
  </div>

  <div id="notification" class="notification"></div>

  <script src="/admin/script.js"></script>
</body>
</html>
